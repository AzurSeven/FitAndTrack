<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Fitness App Pro - v0.1 Alpha</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: { app: { bg: '#0f0f0f', card: '#1c1c1e', input: '#2c2c2e', accent: '#8b5cf6', accentDark: '#7c3aed', success: '#22c55e', text: '#e5e5e5', subtext: '#a1a1aa', danger: '#ef4444', topSet: '#ef4444' } },
                    fontFamily: { sans: ['Inter', 'sans-serif'] }
                }
            }
        }
    </script>
    <style>
        .hide-scrollbar::-webkit-scrollbar { display: none; }
        .hide-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }
        .fade-in { animation: fadeIn 0.3s ease-in-out; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        input[type=number]::-webkit-inner-spin-button, input[type=number]::-webkit-outer-spin-button { -webkit-appearance: none; margin: 0; }
        
        /* Nav Active State */
        .nav-btn { color: #6b7280; transition: all 0.3s ease; }
        .nav-btn.active { color: #8b5cf6 !important; } 
        .nav-btn.active svg { filter: drop-shadow(0 0 8px rgba(139, 92, 246, 0.6)); transform: scale(1.15); }
        
        /* Validation Button State */
        .btn-validated { background-color: #22c55e !important; color: black !important; border-color: #22c55e !important; }

        #cloud-toast { transition: opacity 0.3s ease, transform 0.3s ease; }
        .toast-hidden { opacity: 0; transform: translateY(-20px); pointer-events: none; }
        .toast-visible { opacity: 1; transform: translateY(0); }
    </style>
</head>
<body class="bg-app-bg text-app-text font-sans h-screen flex flex-col overflow-hidden">

    <div id="cloud-toast" class="fixed top-4 left-1/2 -translate-x-1/2 z-[110] bg-gray-800 border border-gray-600 px-4 py-2 rounded-full shadow-2xl flex items-center gap-2 toast-hidden">
        <div class="w-2 h-2 bg-green-500 rounded-full animate-pulse"></div>
        <span class="text-xs font-bold text-white">Sauvegarde...</span>
    </div>

    <section id="view-auth" class="fixed inset-0 z-[100] bg-[#0f0f0f] flex flex-col items-center justify-center p-6 transition-all duration-500 overflow-y-auto">
        <div class="w-full max-w-sm text-center space-y-6">
            <h1 class="text-4xl font-black italic text-app-accent mb-8">FITNESS<br><span class="text-white">PRO</span></h1>
            <div id="auth-login-container" class="space-y-4 fade-in">
                <h2 class="text-xl font-bold text-white">Connexion</h2>
                <input type="email" id="login-email" placeholder="Email" class="w-full p-4 rounded-xl bg-app-input border border-gray-700 text-white outline-none focus:border-app-accent">
                <input type="password" id="login-pass" placeholder="Mot de passe" class="w-full p-4 rounded-xl bg-app-input border border-gray-700 text-white outline-none focus:border-app-accent">
                <button onclick="loginUser()" class="w-full bg-app-accent hover:bg-app-accentDark text-white font-bold py-4 rounded-xl shadow-lg transition">Se connecter</button>
                <div class="flex justify-between text-xs text-gray-400 mt-4 px-2"><button onclick="switchAuthMode('register')" class="text-app-accent font-bold hover:text-white">Créer un compte</button></div>
            </div>
            <div id="auth-register-container" class="space-y-3 hidden fade-in">
                <h2 class="text-xl font-bold text-white">Inscription</h2>
                <div class="grid grid-cols-2 gap-2">
                    <input type="text" id="reg-fname" placeholder="Prénom" class="w-full p-4 rounded-xl bg-app-input border border-gray-700 text-white outline-none focus:border-app-accent">
                    <input type="text" id="reg-lname" placeholder="Nom" class="w-full p-4 rounded-xl bg-app-input border border-gray-700 text-white outline-none focus:border-app-accent">
                </div>
                <input type="text" id="reg-pseudo" placeholder="Pseudo" class="w-full p-4 rounded-xl bg-app-input border border-gray-700 text-white outline-none focus:border-app-accent">
                <input type="email" id="reg-email" placeholder="Email" class="w-full p-4 rounded-xl bg-app-input border border-gray-700 text-white outline-none focus:border-app-accent">
                <input type="password" id="reg-pass" placeholder="Mot de passe" class="w-full p-4 rounded-xl bg-app-input border border-gray-700 text-white outline-none focus:border-app-accent">
                <button onclick="registerUser()" class="w-full bg-white text-black font-bold py-4 rounded-xl shadow-lg transition">S'inscrire</button>
                <div class="text-center text-xs text-gray-400 mt-2">Déjà un compte ? <button onclick="switchAuthMode('login')" class="text-app-accent font-bold hover:text-white">Se connecter</button></div>
            </div>
            <p id="auth-message" class="text-sm font-bold text-red-400 mt-4 min-h-[20px]"></p>
        </div>
    </section>

    <header class="sticky top-0 z-50 bg-app-bg/95 backdrop-blur-sm p-4 border-b border-gray-800 flex justify-between items-center h-16">
        <h1 id="page-title" class="text-xl font-bold tracking-tight">Accueil</h1>
        <div class="flex items-center gap-3">
            <button id="header-add-btn" onclick="switchTab('view-add', null, 'Création')" class="hidden bg-app-accent hover:bg-white hover:text-black text-white w-8 h-8 rounded-full flex items-center justify-center transition">
                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2.5" stroke="currentColor" class="w-5 h-5"><path stroke-linecap="round" stroke-linejoin="round" d="M12 4.5v15m7.5-7.5h-15" /></svg>
            </button>
            <div id="workout-timer-display" class="hidden bg-gray-800 px-3 py-1 rounded-full border border-gray-700 flex items-center gap-2 cursor-pointer transition active:scale-95" onclick="returnToActiveWorkout()">
                <div class="w-2 h-2 bg-red-500 rounded-full animate-pulse"></div>
                <span id="timer-val" class="font-mono font-bold text-sm">00:00</span>
            </div>
        </div>
    </header>

    <main class="flex-grow overflow-y-auto p-4 pb-24 hide-scrollbar relative">
        
        <section id="view-home" class="view-section fade-in">
            <div class="flex justify-between items-end mb-6">
                <div>
                    <p class="text-xs text-gray-400 uppercase font-bold" id="user-role-display">Athlète</p>
                    <h2 class="text-2xl font-bold text-white">Séances à faire</h2>
                </div>
            </div>
            <div class="space-y-4" id="home-workouts-list"></div>
        </section>

        <section id="view-library" class="view-section hidden fade-in">
            <div id="coach-selector-container" class="hidden mb-6 bg-app-card p-3 rounded-xl border border-app-accent/30 shadow-lg">
                <label class="text-[10px] text-app-accent uppercase font-bold tracking-wider mb-1 block">Gestion Athlète :</label>
                <div class="relative">
                    <select id="coach-athlete-select" onchange="changeCoachTarget()" class="w-full bg-gray-
